(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5],{2021:(e,t,r)=>{Promise.resolve().then(r.bind(r,5664))},1987:(e,t,r)=>{"use strict";r.d(t,{A:()=>c});var a=r(5155),o=r(6046),n=r(2115),s=r(6045);class i extends Error{}i.prototype.name="InvalidTokenError";let c=e=>t=>{let r=(0,o.useRouter)();(0,n.useEffect)(()=>{let e=(0,s.gf)();e&&c(e)||r.push("/pages/public/login")},[r]);let c=e=>{try{let t=function(e,t){let r;if("string"!=typeof e)throw new i("Invalid token specified: must be a string");t||(t={});let a=!0===t.header?0:1,o=e.split(".")[a];if("string"!=typeof o)throw new i(`Invalid token specified: missing part #${a+1}`);try{r=function(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw Error("base64 string is not of the correct length")}try{var r;return r=t,decodeURIComponent(atob(r).replace(/(.)/g,(e,t)=>{let r=t.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r}))}catch(e){return atob(t)}}(o)}catch(e){throw new i(`Invalid token specified: invalid base64 for part #${a+1} (${e.message})`)}try{return JSON.parse(r)}catch(e){throw new i(`Invalid token specified: invalid json for part #${a+1} (${e.message})`)}}(e),r=Date.now()/1e3;return!!t.exp&&t.exp>r}catch(e){return!1}};return(0,a.jsx)(e,{...t})}},6045:(e,t,r)=>{"use strict";r.d(t,{Lx:()=>n,gf:()=>o,y4:()=>s});let a=e=>{document.cookie="token=".concat(e,"; path=/; samesite=strict;")},o=()=>{let e="token=",t=decodeURIComponent(document.cookie).split(";");for(let r=0;r<t.length;r++){let a=t[r].trim();if(0===a.indexOf(e))return a.substring(e.length,a.length)}return null},n=async e=>{try{let t=await fetch("".concat("http://localhost:8080/api","/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),credentials:"include"});if(!t.ok){let e=await t.json();throw console.error("Erro ao realizar login:",e),Error("Erro ao realizar login")}let r=await t.json(),o=r.content.token;return a(o),r}catch(e){throw console.error("Erro ao realizar login:",e),e}},s=()=>{document.cookie="token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;",window.location.href="/pages/public/login"}},473:(e,t,r)=>{"use strict";r.d(t,{U:()=>o});let a=()=>{let e="token=";for(let t of decodeURIComponent(document.cookie).split(";"))if((t=t.trim()).startsWith(e))return t.substring(e.length);return null},o=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let r=a();if(!r)throw Error("Token n\xe3o encontrado. Fa\xe7a login novamente.");let o={...t.headers,"Content-Type":"application/json",Authorization:"Bearer ".concat(r)},n=await fetch("".concat("http://localhost:8080/api").concat(e),{...t,headers:o});if(!n.ok){let e;let t=await n.text();try{e=t?JSON.parse(t):{}}catch(t){e={message:"Erro desconhecido ao processar a resposta"}}throw Error("Erro na requisi\xe7\xe3o: ".concat(n.status," - ").concat(e.message||n.statusText))}let s=n.headers.get("content-type");if(s&&s.includes("application/json"))return await n.json();throw Error("Resposta n\xe3o \xe9 JSON.")}catch(e){throw console.error("Erro ao realizar authenticatedFetch:",e),e}}},1350:(e,t,r)=>{"use strict";r.d(t,{$V:()=>i,F:()=>n,lJ:()=>s,xq:()=>o});var a=r(473);let o=async()=>{try{return(await (0,a.U)("/feiras")).content||[]}catch(e){return console.error("Erro ao buscar as feiras:",e),[]}},n=async e=>{try{return await (0,a.U)("/feiras",{method:"POST",body:JSON.stringify(e)})}catch(e){throw console.error("Erro ao enviar dados da feira:",e),e}},s=async e=>{try{await (0,a.U)("/feiras/feira/".concat(e),{method:"DELETE"})}catch(e){throw console.error("Erro ao excluir a feira:",e),e}},i=async(e,t)=>{try{return await (0,a.U)("/feiras/feira/".concat(e),{method:"PUT",body:JSON.stringify(t)})}catch(e){throw console.error("Erro ao atualizar a feira:",e),e}}},5664:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>h});var a=r(5155),o=r(2115),n=r(473);let s=async e=>{try{return await (0,n.U)("/feiras/".concat(e.feiraId,"/eventos"),{method:"POST",body:JSON.stringify({data:e.data.toISOString().split("T")[0]}),headers:{"Content-Type":"application/json"}}),{id:Date.now(),data:e.data,feiraId:e.feiraId}}catch(e){throw console.error("Erro ao adicionar evento:",e),e}},i=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"id";try{let o=await (0,n.U)("/feiras/".concat(e,"/eventos?page=").concat(t,"&size=").concat(r,"&sort=").concat(a),{method:"GET"});if(!o||"object"!=typeof o)throw Error("Resposta inv\xe1lida da API: n\xe3o \xe9 um objeto. Resposta completa: ".concat(JSON.stringify(o)));if(!Array.isArray(o.content))throw Error("Resposta inv\xe1lida da API: content n\xe3o \xe9 um array. Resposta completa: ".concat(JSON.stringify(o)));return o.content.map(t=>({id:t.id,data:new Date(t.data),feiraId:e}))||[]}catch(e){return console.error("Erro ao buscar eventos:",e),[]}},c=async(e,t)=>{try{await (0,n.U)("/feiras/".concat(e,"/eventos/evento/").concat(t),{method:"DELETE"}),console.log("Evento exclu\xeddo com sucesso.")}catch(e){throw console.error("Erro ao excluir evento:",e),e}};var l=r(1350);let d=e=>{let{isOpen:t,onClose:r,onSubmit:n}=e,[s,i]=(0,o.useState)(null),c=()=>{i(null),r()};return t?(0,a.jsx)("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50",children:(0,a.jsxs)("div",{className:"bg-white p-6 rounded shadow-lg max-w-md w-full",children:[(0,a.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Adicionar Evento"}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-gray-700",children:"Data do Evento"}),(0,a.jsx)("input",{type:"date",className:"w-full px-4 py-2 border rounded",onChange:e=>i(new Date(e.target.value))})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-4",children:[(0,a.jsx)("button",{onClick:c,className:"bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600",children:"Cancelar"}),(0,a.jsx)("button",{onClick:()=>{if(!s){alert("Por favor, preencha a data do evento.");return}n(s),c()},className:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600",children:"Adicionar"})]})]})}):null},h=(0,r(1987).A)(()=>{let[e,t]=(0,o.useState)([]),[r,n]=(0,o.useState)([]),[h,u]=(0,o.useState)(null),[p,f]=(0,o.useState)(!1);(0,o.useEffect)(()=>{(async()=>{try{let e=await (0,l.xq)();n(e)}catch(e){console.error("Erro ao buscar feiras:",e)}})()},[]),(0,o.useEffect)(()=>{h&&(async()=>{try{let e=await i(h.id);t(e.map(e=>({...e,data:new Date(e.data)})))}catch(e){console.error("Erro ao buscar eventos:",e)}})()},[h]);let m=async e=>{if(h)try{let r=await s({data:e,feiraId:h.id}),a={id:r.id,data:new Date(r.data),feiraId:h.id};t(e=>[...e,a]),f(!1)}catch(e){console.error("Erro ao adicionar evento:",e)}},x=async e=>{if(h&&window.confirm("Tem certeza que deseja excluir este evento?"))try{await c(h.id,e),t(t=>t.filter(t=>t.id!==e))}catch(e){console.error("Erro ao excluir o evento:",e),e instanceof Error&&e.message.includes("400 - Erro de integridade")?alert("N\xe3o foi poss\xedvel deletar o evento pois ele possui refer\xeancias de feiras."):alert("Ocorreu um erro ao tentar deletar o evento.")}};return(0,a.jsxs)("div",{className:"flex flex-col min-h-screen bg-gray-100 p-5",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold mb-6",children:"Gerenciar Eventos"}),(0,a.jsxs)("div",{className:"mb-4 flex items-center",children:[(0,a.jsxs)("select",{className:"px-4 py-2 border rounded mr-2",value:(null==h?void 0:h.id)||"",onChange:e=>{let t=Number(e.target.value);u(r.find(e=>e.id===t)||null)},children:[(0,a.jsx)("option",{value:"",disabled:!0,children:"Selecione uma feira"}),r.map(e=>(0,a.jsx)("option",{value:e.id,children:e.nome},e.id))]}),(0,a.jsx)("button",{onClick:()=>h&&console.log("Feira ".concat(h.nome," selecionada")),className:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600",children:"Selecionar Feira"})]}),h&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h2",{className:"text-2xl font-semibold",children:h.nome}),(0,a.jsx)("p",{className:"text-gray-700",children:h.descricao})]}),(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsx)("button",{onClick:()=>f(!0),className:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 w-auto",children:"Adicionar Evento"})}),(0,a.jsxs)("section",{className:"mb-8",children:[(0,a.jsx)("h2",{className:"text-2xl font-semibold mb-4",children:"Pr\xf3ximos Eventos"}),(0,a.jsxs)("table",{className:"min-w-full bg-white border border-gray-300",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"bg-gray-200",children:[(0,a.jsx)("th",{className:"py-2 px-4 border-b",children:"Data"}),(0,a.jsx)("th",{className:"py-2 px-4 border-b",children:"Op\xe7\xf5es"})]})}),(0,a.jsx)("tbody",{children:e.length>0?e.map(e=>(0,a.jsxs)("tr",{className:"text-center",children:[(0,a.jsx)("td",{className:"py-2 px-4 border-b",children:e.data.toLocaleDateString()}),(0,a.jsx)("td",{className:"py-2 px-4 border-b",children:(0,a.jsx)("button",{className:"bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600",onClick:()=>x(e.id),children:"Excluir"})})]},e.id)):(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:2,className:"py-4 text-center text-gray-500",children:"Nenhum evento encontrado."})})})]})]})]}),(0,a.jsx)(d,{isOpen:p,onClose:()=>f(!1),onSubmit:e=>m(e)})]})})},6046:(e,t,r)=>{"use strict";var a=r(6658);r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}})}},e=>{var t=t=>e(e.s=t);e.O(0,[441,517,358],()=>t(2021)),_N_E=e.O()}]);